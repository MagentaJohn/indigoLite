<!DOCTYPE html>
<html>
  <head>
    <title>My Game</title>
    <style>
    body {
      padding: 0px;
      margin: 20px;
      overflow-x: hidden;
      overflow-y: hidden;
      background-image: url('rules/FlicFlacV4.png');
      background-size: 100vw 100vh;
      background-color: black;
      font-family: arial;
      font-size: 20px;
    }    
    </style>

    <link rel="stylesheet" href="./Rules.css" />    
  </head>
  <body>    
    <div id="readResults" class="configParams">
      <div>
        <i>1) Choose your pieces.</i>    
        <span title="On the two dimensional board, blocks appear as rectangles and the cylinders as hexagons.">
          <div>
            <label for="blockShape" class="configLabel">You are ... BLOCKS</label>
            <input id="blockShape" style="flex-direction: row-reverse; accent-color: black;"  type="radio" name="shape" value=1>  
          </div>
          <div>
            <label for="cylinderShape" class="configLabel">CYLINDERS</label>
            <input id="cylinderShape" style="flex-direction: row-reverse; accent-color: black;" type="radio" name="shape" value=0>      
          </div>
        </span>
      </div>

      <br>
      <div>
        <i>2) Inform your opponent of your local IP Address & Port</i><br>
        <span title="This is your IP address and your port number. No need to change local IP address given.">
          <div id="errorMsg2" class="configErrorMsg"><b>Invalid IP Address or Port. </b><br>
            The IP address should be non-zero and take the form &quot;n.n.n.n&quot; <br>
            ... where n is a decimol number in the range 0 <=n <= 255.<br>
            The port number should be a non-zero integer in the range 0 < n <= 65535.<br>
          </div>
          <div>
            <label for="localIp" class="configLabel">Local IP Address:</label>
            <input id="localIp" class="configValue" type="text" name="localIp">  
          </div>
          <div>
            <label for="localPort" class="configLabel">Local Port:</label>
            <input id="localPort" class="configValue" type="number" name="localPort">    
          </div>
        </span>
      </div>


      <br>
      <div>
        <i>3) Enter your opponents IP Address & Port</i><br>
        <span title="When your opponent runs this game, he sees a different local IP address (& port number).  
        You need to obtain this information and enter their details here.">
          <div id="errorMsg3" class="configErrorMsg"><b>Invalid IP Address or Port. </b><br>
            The IP address should be non-zero and take the form &quot;n.n.n.n&quot; <br>
            ... where n is a decimol number in the range 0 <=n <= 255.<br>
            The port number should be a non-zero integer in the range 0 < n <= 65535.<br> 
          </div>
          <div>
            <label for="remoteIp" class="configLabel">Remote IP Address:</label>
            <input id="remoteIp" class="configValue" type="text" name="remoteIp">  
          </div>
          <div>
            <label for="remotePort" class="configLabel">Remote Port:</label>
            <input id="remotePort" class="configValue" type="number" name="remotePort">  
          </div>  
        </span>
      </div>
      
      <br>
     
      <i>4) Enter agreed game parameters</i><br>
      <div>
        <span title="This is the number of points you need to win. Remember you must win by at least two clear points">
          <div id="errorMsg4A" class="configErrorMsg"><b>Invalid target set as Final Score</b><br>
            The score to win needs to be set as a non-zero positive integer.<br>
          </div>
          <label for="scoreToWin" class="configLabel">Score to Win:</label>
          <input id="scoreToWin" class="configValue" type="number" name="scoreToWin">    
        </span>
      </div>
      <div>
        <span title="This is the number of seconds allowed for each turn. A value of zero disables this timer">
          <div id="errorMsg4B" class="configErrorMsg"><b>Invalid Turn Time</b><br>
            The turn time must be set as as a non-zero positive integer, <br>
            representing the maximum time allowed in seconds for each turn.<br>
          </div>
          <label for="turnTime" class="configLabel">Turn Time:</label>
          <input id="turnTime" class="configValue" type="number" name="turnTime">  
        </span>          
      </div>
      <div>
        <span title="This is the number of seconds allowed for an extended turn after a successful capture. It is suggested to make this half the turn timer above. Once again, a value of zero disables this timer.">
          <div id="errorMsg4C" class="configErrorMsg"><b>Invalid Captor&apos;s Turn Time</b><br>
            The captor&apos;s turn time must be set as as a non-zero positive integer, <br>
            representing the maximum time allowed in seconds for extra turns.<br>
          </div>
          <label for="captorsTime" class="configLabel">Captor&apos;s Time:</label>
          <input id="captorsTime" class="configValue" type="number" name="captorsTime">
        </span>
      </div>
      <div>
        <span title="This is the percentage probabilty that a random event will occur. A value of zero prohibits these occurences.">
          <div id="errorMsg4D" class="configErrorMsg"><b>Invalid Random Event Probability</b><br>
            This probability is a percentage where 0 <= probability <= 100 <br>
          </div>
          <label for="randEventProb" class="configLabel">Random Event Probability:</label>
          <input id="randEventProb" class="configValue" type="number" name="randEventProb">              
        </span>
      </div>
    </div>
    
    <script>
    
    function LocalStorageRead() {
      const sFlicFlac = window.localStorage.getItem("FlicFlac");
      const oFlicFlac = JSON.parse(sFlicFlac)

      document.getElementById("readResults").style.border="4px solid blue"

      
      console.log("*** " + sFlicFlac + " ***");
      if (oFlicFlac.configLocalShape == 1) {
          document.getElementById("blockShape").checked=true
        }
      else{
        document.getElementById("cylinderShape").checked=true
      }

      document.getElementById("localIp").defaultValue = oFlicFlac.configLocalIpAddr
      document.getElementById("localPort").defaultValue = oFlicFlac.configLocalPort
      document.getElementById("remoteIp").defaultValue = oFlicFlac.configRemoteIpAddr
      document.getElementById("remotePort").defaultValue = oFlicFlac.configRemotePort
      document.getElementById("scoreToWin").defaultValue = oFlicFlac.configScoreToWin
      document.getElementById("turnTime").defaultValue = oFlicFlac.configTurnTime
      document.getElementById("captorsTime").defaultValue = oFlicFlac.configCaptorsTime
      document.getElementById("randEventProb").defaultValue = oFlicFlac.configRandEventProb

      console.log("IP Result1:" + isValidIP(oFlicFlac.configLocalIpAddr))
      
    }
    
    function LocalStorageWrite() {
      // reread the old cache entry
      const sFlicFlac = window.localStorage.getItem("FlicFlac");
      var oFlicFlac = JSON.parse(sFlicFlac);

      // validate the new parameters

      var localIp = document.getElementById("localIp").value
      var localPort = document.getElementById("localPort").value
      var remoteIp = document.getElementById("remoteIp").value
      var remotePort = document.getElementById("remotePort").value
      var scoreToWin = document.getElementById("scoreToWin").value
      var turnTime = document.getElementById("turnTime").value
      var captorsTime = document.getElementById("captorsTime").value
      var randEventProb = document.getElementById("randEventProb").value

      var invalidParams = false;
      if ((localIp === "0.0.0.0")
      || (isValidIP(localIp) === false)
      || (isValidPort(localPort) === false))
      {
        document.getElementById("errorMsg2").style.display="inline-block";
        invalidParams = true;
      }

      if ((remoteIp === "0.0.0.0")
      || (isValidIP(remoteIp) === false)
      || (isValidPort(remotePort) === false))
      {
        document.getElementById("errorMsg3").style.display="inline-block";
        invalidParams = true;
      }

      if (scoreToWin < 0)
      {
        document.getElementById("errorMsg4A").style.display="inline-block";
        invalidParams = true;
      }

      if (turnTime < 0)
      {
        document.getElementById("errorMsg4B").style.display="inline-block";
        invalidParams = true;
      }

      if (captorsTime < 0)
      {
        document.getElementById("errorMsg4C").style.display="inline-block";
        invalidParams = true;        
      }

      if ((randEventProb < 0) || (randEventProb > 100))
      {
        document.getElementById("errorMsg4D").style.display="inline-block";
        invalidParams = true;
      }

      if (invalidParams == true) {
        // leave error message(s) showing if one or more paramters invalid
        document.getElementById("readResults").style.border="4px solid red"
        return;
      }
      else {
        document.getElementById("readResults").style.border="4px solid blue"

        // infuse new settings into object

        oFlicFlac.configLocalIpAddr = localIp;
        oFlicFlac.configLocalPort = localPort;
        oFlicFlac.configRemoteIpAddr = remoteIp;
        oFlicFlac.configRemotePort = remotePort;
        oFlicFlac.configScoreToWin = scoreToWin;
        oFlicFlac.configTurnTime = turnTime;
        oFlicFlac.configCaptorsTime = captorsTime;
        oFlicFlac.configRandEventProb = randEventProb;

        // create new string to write as new cache
        const sNewFlicFlac = JSON.stringify(oFlicFlac);      
        window.localStorage.setItem("FlicFlac", sNewFlicFlac);

        document.getElementById("readResults").style.border="4px solid green"

      }
    }

    const isValidIP = (ip) => {
      const ipv4Pattern = /^(25[0-5]|2[0-4]\d|1\d{2}|\d{1,2})(\.(25[0-5]|2[0-4]\d|1\d{2}|\d{1,2})){3}$/;
      if (ipv4Pattern.test(ip)) {
        return true;
      }

      // Check for IPv6
      const ipv6Pattern = /^([\da-fA-F]{1,4}:){7}[\da-fA-F]{1,4}$/;
      if (ipv6Pattern.test(ip)) {
        return true;
      }

      return false;
    }
    function isValidPort(port) {
      if ((port > 0) && (port <= 65535))
        return true
      else
        return false
    }

    
    </script>
    <br>
    <br>

    <div id="Index">
      <a href = "./index1.html">
        <button class="myButton" style="margin-right: 2em;">Play</button>
      </a>
      <a href = "./Rules1.html">
        <button class="myButton" style="margin-right: 2em;">Rules</button>
      </a>
      <button class="myRulesButton" style="font-size: 1em;" onclick = "LocalStorageRead()"> READ </button>
      <button class="myRulesButton" style="font-size: 1em;" onclick = "LocalStorageWrite()"> WRITE </button>
  
    </div>

  </body>
</html>
